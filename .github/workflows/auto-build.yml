name: Build & Release macOS App

on:
  push:
    tags:
      - 'v*' # Trigger on version tags like v1.0.0

permissions:
  contents: write

jobs:
  build:
    runs-on: macos-15
    env:
      GITHUB_ACCESS_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v3

      - name: Select Xcode 16.4
        run: sudo xcode-select -s /Applications/Xcode.app

      - name: ðŸ§± Build .app
        run: |
          xcodebuild -scheme InjectHub \
                     -project InjectHub.xcodeproj \
                     -configuration Release \
                     -derivedDataPath build \
                     CODE_SIGN_IDENTITY="" \
                     CODE_SIGNING_REQUIRED=NO

      - name: ðŸ“¦ Zip the .app
        run: |
          mkdir -p release
          APP_PATH=$(find build/Build/Products/Release -name "*.app" -maxdepth 1 | head -n 1)
          echo "App found at: $APP_PATH"
          cp -R "$APP_PATH" ./release/InjectHub.app
          pushd release > /dev/null
          zip -r InjectHub.zip InjectHub.app
          popd > /dev/null

      - name: ðŸš€ Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: release/InjectHub.zip
